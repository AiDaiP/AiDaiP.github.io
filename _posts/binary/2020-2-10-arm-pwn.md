---
clayout: post
title:  "arm-pwn"
date:   2020-2-10
desc: ""
keywords: ""
categories: [Binary]
tags: []
icon: icon-html
---

# arm-pwn

### 环境配置

qemu

```
apt-get install qemu
```

依赖库

```
apt-get install -y gcc-aarch64-linux-gnu g++-aarch64-linux-gnu
```

pwntools-binutils

```
apt-get install software-properties-common
apt-add-repository ppa:pwntools/binutils
apt-get update
apt-get install binutils-$ARCH-linux-gnu
```

以下安装包存在

```
binutils-aarch64-linux-gnu
binutils-mips-linux-gnu
binutils-powerpc-linux-gnu
```

以下暂时⑧存在

```
binutils-alpha-linux-gnu
binutils-arm-linux-gnu
binutils-avr-linux-gnu
binutils-cris-linux-gnu
binutils-hppa-linux-gnu
binutils-ia64-linux-gnu
binutils-m68k-linux-gnu
binutils-mips64-linux-gnu
binutils-msp430-linux-gnu
binutils-powerpc64-linux-gnu
binutils-s390-linux-gnu
binutils-sparc-linux-gnu
binutils-vax-linux-gnu
binutils-xscale-linux-gnu
binutils-i386-linux-gnu
binutils-x86_64-linux-gnu
```

跑

```
qemu-aarch64 -L /usr/aarch64-linux-gnu ./pwn
```

```
r = process(['qemu-aarch64', '-L', '/usr/aarch64-linux-gnu', './pwn'])
```



### 函数调用

#### arm32

![ARM_Calling_Convention](https://raw.githubusercontent.com/AiDaiP/images/master/pwn/ARM_Calling_Convention.png)

第1-4个参数分别保存在r0-r3，剩下的从右向左依次入栈，被调用者实现栈平衡，返回值在r0

pc寄存器保存下一条指令地址，相当于x86的eip

#### arm64

第1-4个参数分别保存在x0-x7，剩下的从右向左依次入栈，被调用者实现栈平衡，返回值在x0



### arm64基本操作

arm64中取消32位的ldm,sdm,push,pop

arm64对栈的操作16字节对齐

#### sp和fp寄存器

* sp保存栈顶地址
* fp(x29寄存器)，属于通用寄存器, 某些时刻利用它保存栈底地址

#### str和ldr

* str(store register)

  将数据从寄存器存到栈中

  stp同时操作两个寄存器

  ```
  stp x0,x1,[sp,#0x10]	;将x0,x1放到sp+0x10
  ```

* ldr(load register)

  将数据从栈读到寄存器中

  ldp同时操作两个寄存器

  ```
  ldp x1,x0,[sp,#0x10]	;从sp+0x10读取数据到x1,x0
  ```

### lr寄存器

x30，储存返回地址

### bl和ret

* bl

  l：将下一条指令的地址放入lr寄存器

  b：跳转

* ret

  lr的值赋给pc

  

