---
clayout: post
title:  "afl从入门到放弃"
date:   2019-11-10
desc: ""
keywords: ""
categories: [Binary]
tags: [afl]
icon: icon-html
---

# afl从入门到放弃

## 安装

http://lcamtuf.coredump.cx/afl/

```
wget http://lcamtuf.coredump.cx/afl/releases/afl-latest.tgz
tar zxvf afl-latest.tgz
cd afl-2.52b
make
make install
```



## 基本操作

```
afl-gcc gcc的封装
afl-g++ g++的封装
afl-clang clang的封装
afl-clang++ clang++的封装
afl-fuzz 对目标程序进行fuzz。
afl-analyze 对用例进行分析
afl-plot 生成测试任务的状态图
afl-tmin 对用例进行简化
afl-cmin 对用例进行简化
afl-whatsup 查看测试任务的状态
afl-gotcpu 查看当前CPU的状态
afl-showmap 对单个用例进行执行路径跟踪
```



### afl-fuzz

```
afl-fuzz 2.52b by <lcamtuf@google.com>
afl-fuzz: invalid option -- 'h'

afl-fuzz [ options ] -- /path/to/fuzzed_app [ ... ]

Required parameters:

  -i dir        - input directory with test cases
  -o dir        - output directory for fuzzer findings

Execution control settings:

  -f file       - location read by the fuzzed program (stdin)
  -t msec       - timeout for each run (auto-scaled, 50-1000 ms)
  -m megs       - memory limit for child process (50 MB)
  -Q            - use binary-only instrumentation (QEMU mode)

Fuzzing behavior settings:

  -d            - quick & dirty mode (skips deterministic steps)
  -n            - fuzz without instrumentation (dumb mode)
  -x dir        - optional fuzzer dictionary (see README)

Other stuff:

  -T text       - text banner to show on the screen
  -M / -S id    - distributed mode (see parallel_fuzzing.txt)
  -C            - crash exploration mode (the peruvian rabbit thing)

For additional tips, please consult /usr/local/share/doc/afl/README.
```



### 例

```c
#include <stdio.h> 
#include <stdlib.h> 
#include <signal.h> 

int main(int argc, char const *argv[])
{
	char buf[20];
	gets(buf);
    if(buf[0] == 'a' & buf[1] == 'b')
    {
        raise(SIGSEGV);
    }
    printf("Hello World!");
	return 0;
}
```

有栈溢出

输入的字符串前两字节为'ab'也会crash

用afl-gcc编译

```
afl-gcc -g -o test test.c
```

编译后会有插桩

![2](https://raw.githubusercontent.com/AiDaiP/images/master/afl/2.jpg)



开始fuzz

fuzz_in文件夹中是语料库，不能为空

放入一个写有字符串'1'的文件

```
afl-fuzz -i ./fuzz_in -o ./fuzz_out ./test
```

![1](https://raw.githubusercontent.com/AiDaiP/images/master/afl/1.jpg)

![3](https://raw.githubusercontent.com/AiDaiP/images/master/afl/3.jpg)



fuzz_out文件夹

![4](https://raw.githubusercontent.com/AiDaiP/images/master/afl/4.jpg)

ueue文件夹包含每个独特执行路径的测试用例，第一个是给出的起始文件

![5](https://raw.githubusercontent.com/AiDaiP/images/master/afl/5.jpg)

```
1
```

```
a
```

hang文件夹包含导致测试程序超时的测试用例

crash文件夹包含导致测试程序崩溃的测试用例

跑出来3个crash

```
abaLaaaaa@aa
```

前两字节为'ab'

```
aamaWaaaaaaaaaaaaaaaaaaLaaaaaaaaaaaaaWaaaaaaaa
```

栈溢出

```
1818 0066 f2f2 f2f2 f2db 0000 1818 0060
1866 f2f2 f2f2 f2db 0000 8018 0060 1ae8
4318 b80b 50ff 1850 00e8 4318 b818 50ff
1850 0000 8080 
```

栈溢出